limit_conn_zone $server_name zone=servers:10m;

limit_conn servers 1000;

ssl_session_timeout 1d;
ssl_session_cache shared:SSL:50m;
ssl_session_tickets off;

ssl_protocols TLSv1.2 TLSv1.3;
ssl_ciphers TLS13-AES-256-GCM-SHA384:TLS13-AES-128-GCM-SHA256:TLS13-AES-128-CCM-8-SHA256:TLS13-AES-128-CCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-CCM:ECDHE-ECDSA-AES256-CCM:ECDHE-ECDSA-AES128-CCM8:ECDHE-ECDSA-AES256-CCM8:ECDHE-ECDSA-AES128-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA38:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-CCM:DHE-RSA-AES256-CCM:DHE-RSA-AES128-CCM8:DHE-RSA-AES256-CCM8:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA384:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA256;
ssl_prefer_server_ciphers on;

ssl_stapling on;
ssl_stapling_verify on;

resolver 127.0.0.11 ipv6=off;

server_tokens off;

proxy_http_version 1.1;
proxy_set_header Upgrade $http_upgrade;
proxy_set_header Connection "upgrade";

access_log            /var/log/nginx/access.log main;
error_log             /var/log/nginx/error.log warn;

client_max_body_size    20000M;
proxy_send_timeout      120;
proxy_read_timeout      120;
proxy_request_buffering off;
proxy_buffering         off;

gzip on;
gzip_disable "msie6";
gzip_vary on;
gzip_comp_level 6;
gzip_min_length 1000;
gzip_proxied any;
gzip_types *;


server {
    listen 443 ssl http2;
    server_name testrp1.kheops.online;
    
    location / {
      proxy_pass http://webstatic_1:8080;
      proxy_redirect http://webstatic_1:8080 https://testrp1.kheops.online;
    }
}


server {
    listen 443 ssl http2;
    server_name testrp2.kheops.online;

    location / {
      proxy_pass http://webstatic_2:8080;
      proxy_redirect http://webstatic_2:8080 https://testrp2.kheops.online;
    }
}


server {
    listen 443 ssl http2;
    server_name testrp3.kheops.online;

    location / {
      proxy_pass http://webstatic_3:8080;
      proxy_redirect http://webstatic_3:8080 https://testrp3.kheops.online;
    }
}


server {
    listen 443 ssl http2;
    server_name test2.kheops.online;

    location / {
      proxy_pass http://10.5.5.28:8080;
      proxy_redirect http://10.5.5.28:8080 https://test2.kheops.online;
    }
}
